function m = nanmedian_eb(x, thresh)

if nargin < 2
    thresh = 0;
end
sz = size(x);

if numel(x) < 4
    d4 = 1;
    if numel(x) < 3
        d3 = 1;
    else
        d3 = sz(3);
    end
else
    d4 = sz(4);
end

m = zeros(d4, 1);

for n = 1:d4
    x_vec = abs(vec(x(:,:,:,n)));
    x_vec(x_vec < thresh) = nan;
    m(n) = median(x(~isnan(x)));